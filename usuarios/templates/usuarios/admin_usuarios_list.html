{% extends "base.html" %}
{% block title %}Usuarios — Admin{% endblock %}
{% block meta_description %}Listado de usuarios con filtros, búsqueda y acceso al perfil administrativo.{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto px-4 py-8">

  <!-- Header + búsqueda -->
  <header class="mb-6 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
    <div>
      <h1 class="text-2xl sm:text-3xl font-extrabold">Usuarios</h1>
      <p class="text-white/70">Buscá, filtrá y entrá al perfil de cada usuario.</p>
    </div>
    <form method="get" action="" class="w-full md:w-auto">
      <div class="flex gap-2">
        <input name="q" value="{{ f.q }}"
               placeholder="Usuario, email, nombre o DNI…"
               class="w-full md:w-96 rounded-lg border border-white/10 bg-white text-black px-3 py-2 focus:outline-none focus:ring-2 focus:ring-neon"/>
        <button class="rounded-lg bg-neon text-black font-semibold px-4 py-2">Buscar</button>
      </div>
    </form>
  </header>

  <!-- Filtros -->
  <form method="get" action="" class="card p-4 shadow-soft mb-6 grid gap-3 sm:grid-cols-5 text-sm">
    <div>
      <label class="block text-white/70 mb-1">Estado verificación</label>
      <select name="estado" class="w-full rounded-md border border-white/10 bg-white text-black px-3 py-2 focus:ring-2 focus:ring-neon">
        <option value="">Todos</option>
        <option value="pendiente" {% if f.estado == 'pendiente' %}selected{% endif %}>Pendiente</option>
        <option value="aprobado"  {% if f.estado == 'aprobado' %}selected{% endif %}>Aprobado</option>
        <option value="rechazado" {% if f.estado == 'rechazado' %}selected{% endif %}>Rechazado</option>
      </select>
    </div>
    <div>
      <label class="block text-white/70 mb-1">Activo</label>
      <select name="activo" class="w-full rounded-md border border-white/10 bg-white text-black px-3 py-2 focus:ring-2 focus:ring-neon">
        <option value="">Todos</option>
        <option value="1" {% if f.activo == '1' %}selected{% endif %}>Sí</option>
        <option value="0" {% if f.activo == '0' %}selected{% endif %}>No</option>
      </select>
    </div>
    <div class="sm:col-span-2 flex items-end gap-2">
      <input type="hidden" name="q" value="{{ f.q }}">
      <button class="rounded-lg bg-neon text-black font-semibold px-4 py-2">Aplicar</button>
      <a href="{% url 'admin_usuarios_list' %}" class="rounded-lg border border-white/10 px-4 py-2 hover:bg-white/5">Limpiar</a>
    </div>
    <div class="flex items-end justify-end">
      <a href="{% url 'panel_admin' %}" class="text-sm underline">← Volver al panel</a>
    </div>
  </form>

  <!-- Tabla -->
  <div class="overflow-x-auto card p-0 shadow-soft">
    <table class="w-full text-sm">
      <thead class="bg-white/5 text-black/80">
        <tr>
          <th class="px-3 py-2 text-left">Usuario</th>
          <th class="px-3 py-2 text-left">Nombre</th>
          <th class="px-3 py-2 text-left">Email</th>
          <th class="px-3 py-2 text-left">Estado</th>
          <th class="px-3 py-2 text-left">Activo</th>
          <th class="px-3 py-2 text-left">Saldos</th>
          <th class="px-3 py-2 text-left">Alta</th>
          <th class="px-3 py-2 text-left">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for u in usuarios %}
        <tr class="border-t border-white/10 hover:bg-white/5">
          <td class="px-3 py-2 font-medium">
            <a class="text-accent hover:underline" href="{% url 'admin_usuario_perfil' u.id %}">{{ u.username }}</a>
          </td>
          <td class="px-3 py-2">
            {% if u.first_name or u.last_name %}
              {{ u.first_name }} {{ u.last_name }}
            {% else %}
              {{ u.username }}
            {% endif %}
          </td>
          <td class="px-3 py-2">{{ u.email|default:"—" }}</td>
          <td class="px-3 py-2 capitalize">
            {% if u.estado_verificacion == 'aprobado' %}
              <span class="inline-block rounded-full bg-emerald-500/20 text-emerald-300 px-2 py-0.5 text-xs font-semibold">Aprobado</span>
            {% elif u.estado_verificacion == 'rechazado' %}
              <span class="inline-block rounded-full bg-red-500/20 text-red-300 px-2 py-0.5 text-xs font-semibold">Rechazado</span>
            {% else %}
              <span class="inline-block rounded-full bg-amber-500/20 text-amber-300 px-2 py-0.5 text-xs font-semibold">Pendiente</span>
            {% endif %}
          </td>
          <td class="px-3 py-2">
            {% if u.is_active %}
              <span class="inline-block rounded-full bg-emerald-500/20 text-emerald-300 px-2 py-0.5 text-xs font-semibold">Sí</span>
            {% else %}
              <span class="inline-block rounded-full bg-red-500/20 text-red-300 px-2 py-0.5 text-xs font-semibold">No</span>
            {% endif %}
          </td>
          <td class="px-3 py-2">
            <div class="space-x-1 whitespace-nowrap">
              <span class="inline-block rounded bg-white/10 px-2 py-0.5">$ {{ u.saldo_ars }}</span>
              <span class="inline-block rounded bg-white/10 px-2 py-0.5">{{ u.saldo_usdt }} USDT</span>
              <span class="inline-block rounded bg-white/10 px-2 py-0.5">{{ u.saldo_usd }} USD</span>
            </div>
          </td>
          <td class="px-3 py-2">{{ u.date_joined|date:"d/m/Y H:i" }}</td>
          <td class="px-3 py-2">
            <a class="rounded-md border border-white/10 px-3 py-1 hover:bg-white/5"
               href="{% url 'admin_usuario_perfil' u.id %}">Ver perfil</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="px-3 py-6 text-center text-white/60">Sin resultados.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if usuarios.has_other_pages %}
  <div class="flex justify-center gap-2 py-4">
    {% if usuarios.has_previous %}
      <a class="px-3 py-1 border border-white/10 rounded hover:bg-white/5"
         href="?page={{ usuarios.previous_page_number }}&q={{ f.q }}&estado={{ f.estado }}&activo={{ f.activo }}">«</a>
    {% endif %}
    <span class="px-3 py-1">Página {{ usuarios.number }} / {{ usuarios.paginator.num_pages }}</span>
    {% if usuarios.has_next %}
      <a class="px-3 py-1 border border-white/10 rounded hover:bg-white/5"
         href="?page={{ usuarios.next_page_number }}&q={{ f.q }}&estado={{ f.estado }}&activo={{ f.activo }}">»</a>
    {% endif %}
  </div>
  {% endif %}

</section>
{% endblock %}
