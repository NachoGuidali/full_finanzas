{% extends "base.html" %}
{% block title %}Mis movimientos — Full Finanzas{% endblock %}
{% block meta_description %}Consulta y exportá tus movimientos con filtros.{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto px-4 py-6">
  <header class="mb-6">
    <h1 class="text-2xl font-semibold">Mis <span class="text-neon">movimientos</span></h1>
    <p class="text-gray-700">Filtrá por fecha, moneda o tipo. Podés exportar el resultado.</p>
  </header>

  <!-- Filtros -->
  <form method="get" class="card p-4 mb-6">
    <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-6">
      <label class="block">
        <span class="ff-label">Desde</span>
        <input type="date" name="desde" value="{{ params.desde }}" class="ff-input w-full rounded-lg border border-black/10">
      </label>
      <label class="block">
        <span class="ff-label">Hasta</span>
        <input type="date" name="hasta" value="{{ params.hasta }}" class="ff-input w-full rounded-lg border border-black/10">
      </label>
      <label class="block">
        <span class="ff-label">Tipo</span>
        <select name="tipo" class="ff-select w-full rounded-lg border border-black/10">
          <option value="">Todos</option>
          <option value="compra" {% if params.tipo == 'compra' %}selected{% endif %}>Compra</option>
          <option value="venta"  {% if params.tipo == 'venta'  %}selected{% endif %}>Venta</option>
          <option value="swap"   {% if params.tipo == 'swap'   %}selected{% endif %}>Swap</option>
          <option value="deposito" {% if params.tipo == 'deposito' %}selected{% endif %}>Depósito</option>
          <option value="retiro"   {% if params.tipo == 'retiro'   %}selected{% endif %}>Retiro</option>
        </select>
      </label>
      <label class="block">
        <span class="ff-label">Moneda</span>
        <select name="moneda" class="ff-select w-full rounded-lg border border-black/10">
          <option value="">Todas</option>
          <option value="ARS"  {% if params.moneda == 'ARS'  %}selected{% endif %}>ARS</option>
          <option value="USDT" {% if params.moneda == 'USDT' %}selected{% endif %}>USDT</option>
          <option value="USD"  {% if params.moneda == 'USD'  %}selected{% endif %}>USD</option>
        </select>
      </label>
    </div>

    <div class="mt-3 grid gap-3 sm:grid-cols-3">
      <label class="block">
        <span class="ff-label">Buscar</span>
        <input type="text" name="q" value="{{ params.q }}" placeholder="Descripción o ID…" class="ff-input w-full rounded-lg border border-black/10">
      </label>
      <label class="block">
        <span class="ff-label">Orden</span>
        <select name="orden" class="ff-select w-full rounded-lg border border-black/10">
          <option value="-fecha" {% if params.orden == '-fecha' %}selected{% endif %}>Fecha ↓</option>
          <option value="fecha"  {% if params.orden == 'fecha'  %}selected{% endif %}>Fecha ↑</option>
          <option value="-monto" {% if params.orden == '-monto' %}selected{% endif %}>Monto ↓</option>
          <option value="monto"  {% if params.orden == 'monto'  %}selected{% endif %}>Monto ↑</option>
        </select>
      </label>
      <label class="block">
        <span class="ff-label">Por página</span>
        <select name="por_pagina" class="ff-select w-full rounded-lg border border-black/10">
          {% for n in por_pagina_opts %}
            <option value="{{ n }}" {% if params.por_pagina == n %}selected{% endif %}>{{ n }}</option>
          {% endfor %}
        </select>
      </label>
    </div>

    <div class="mt-4 flex items-center gap-2">
      <button class="btn-neon px-4 py-2">Aplicar</button>
      <a href="{% url 'mis_movimientos' %}" class="rounded-xl border border-gray-300 px-4 py-2 hover:bg-neon/10">Limpiar</a>
      <a href="{% url 'movimientos_exportar' %}?{{ request.GET.urlencode }}"
         class="ml-auto rounded-xl border border-neon/50 text-neon px-4 py-2 hover:bg-neon/10">
        Exportar CSV
      </a>
    </div>
  </form>

  <!-- Tabla -->
  <div class="card p-0 overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr>
          <th class="px-3 py-2 text-left">Fecha</th>
          <th class="px-3 py-2 text-left">Tipo</th>
          <th class="px-3 py-2 text-left">Moneda</th>
          <th class="px-3 py-2 text-left">Monto</th>
          <th class="px-3 py-2 text-left">Saldo antes</th>
          <th class="px-3 py-2 text-left">Saldo después</th>
          <th class="px-3 py-2 text-left">Descripción</th>
          <th class="px-3 py-2 text-left">ID</th>
        </tr>
      </thead>
      <tbody>
        {% for m in page_obj %}
        <tr class="hover:bg-neon/10">
          <td class="px-3 py-2 whitespace-nowrap">{{ m.fecha }}</td>
          <td class="px-3 py-2">{{ m.get_tipo_display }}</td>
          <td class="px-3 py-2">{{ m.moneda }}</td>
          <td class="px-3 py-2">${{ m.monto }}</td>
          <td class="px-3 py-2">${{ m.saldo_antes }}</td>
          <td class="px-3 py-2">${{ m.saldo_despues }}</td>
          <td class="px-3 py-2">{{ m.descripcion }}</td>
          <td class="px-3 py-2">{{ m.codigo }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="px-3 py-6 text-center text-gray-600">Sin movimientos para los filtros seleccionados.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  {% if page_obj.paginator.num_pages > 1 %}
  <nav class="mt-4 flex items-center justify-between text-sm">
    <span class="text-gray-600">
      Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
    </span>
    <div class="flex gap-2">
      {% if page_obj.has_previous %}
        <a class="rounded-lg border border-gray-300 px-3 py-1 hover:bg-neon/10"
           href="?page=1&{{ request.GET.urlencode|cut:'page='|cut:'page=' }}">« Primera</a>
        <a class="rounded-lg border border-gray-300 px-3 py-1 hover:bg-neon/10"
           href="?page={{ page_obj.previous_page_number }}&{{ request.GET.urlencode|cut:'page='|cut:'page=' }}">‹ Anterior</a>
      {% endif %}
      {% if page_obj.has_next %}
        <a class="rounded-lg border border-gray-300 px-3 py-1 hover:bg-neon/10"
           href="?page={{ page_obj.next_page_number }}&{{ request.GET.urlencode|cut:'page='|cut:'page=' }}">Siguiente ›</a>
        <a class="rounded-lg border border-gray-300 px-3 py-1 hover:bg-neon/10"
           href="?page={{ page_obj.paginator.num_pages }}&{{ request.GET.urlencode|cut:'page='|cut:'page=' }}">Última »</a>
      {% endif %}
    </div>
  </nav>
  {% endif %}
</section>

<script>
  
</script>
{% endblock %}
