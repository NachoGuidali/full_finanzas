<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>{% block title %}Exchange ‚Äî Fast Crypto Trading{% endblock %}</title>
  <meta name="description"
    content="{% block meta_description %}Trade crypto pairs with real-time data and simple order entry.{% endblock %}" />
  <link rel="canonical" href="{% block canonical %}{{ request.build_absolute_uri }}{% endblock %}" />

  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ request.build_absolute_uri|default:'' }}" />
  <meta name="twitter:card" content="summary_large_image" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
  (function () {
    try {
      const v = localStorage.getItem('fullfinanzas-theme'); // 'light' | 'dark'
      if (v === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
      else document.documentElement.removeAttribute('data-theme'); // light por defecto
    } catch (_) {}
  })();
</script>
  <script>
    tailwind.config = {
      theme: {
        container: { center: true, padding: '1rem' },
        extend: {
          colors: {
            neon: '#8aff00',
            ink: {
              50: '#0B1020', 100: '#0B1020', 200: '#0B1020', 300: '#0B1020',
              400: '#0B1020', 500: '#0B1020', 600: '#0B1020', 700: '#0B1020',
              800: '#0B1020', 900: '#010318'
            },
            brand: {
              50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc',
              400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca',
              800: '#3730a3', 900: '#312e81',
            },
            success: '#16a34a', danger: '#ef4444', warning: '#f59e0b'
          },
          boxShadow: {
            soft: '0 10px 30px -10px rgba(210,255,0,0.25)'
          },
          keyframes: { float: { '0%,100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-6px)' } } },
          animation: { float: 'float 6s ease-in-out infinite' }
        }
      }
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
  :root {
    /* Light (por defecto) */
    --bg:    #fffb0036;
    --fg:    #0B1020;
    --muted: #475569;
    --card:  #ffffff;
    --ring: #121A36;            /* aro oscuro sobre claro */
    --border: rgba(2,6,23,.12);
    --tint-5:  rgba(2,6,23,.05);
    --tint-10: rgba(2,6,23,.10);
    --input-bg:#ffffff;
    --input-text:#0b1020;
    --input-border:rgba(2,6,23,0.18);
    --input-placeholder:#6b7280;
    --accent: #002141;
    --accent-fg: #121A36;   
  }
  html[data-theme="dark"]{
    --bg:#838282; --fg:#ffffff; --muted:rgba(255,255,255,.70);
    --card:#121A36; --border:rgba(255,255,255,.10);
    --tint-5:rgba(255,255,255,.05); --tint-10:rgba(255,255,255,.10);
    --accent: #002141;          /* neon */
    --accent-fg: #121A36;
  
  
  }
  html{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}

  body{ background:var(--bg); color:var(--fg); }

  .text-accent { color: var(--accent); }

  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:1rem;
    box-shadow:0 10px 20px -12px rgba(0,0,0,.25);
  }

  .ff-logo--light { display: inline; }
  .ff-logo--dark  { display: none; }

  /* si el html tiene data-theme="light", invertimos */
  [data-theme="dark"] .ff-logo--light { display: none; }
  [data-theme="dark"] .ff-logo--dark  { display: inline; }

  /* Adaptadores de utilidades Tailwind */
  .text-white      { color: var(--fg)!important; }
  .text-white\/70  { color: color-mix(in oklab, var(--fg) 70%, transparent)!important; }
  .text-white\/60  { color: color-mix(in oklab, var(--fg) 60%, transparent)!important; }
  .text-white\/50  { color: color-mix(in oklab, var(--fg) 50%, transparent)!important; }
  .text-white\/40  { color: color-mix(in oklab, var(--fg) 40%, transparent)!important; }

  .bg-white\/5     { background-color: var(--tint-5)!important; }
  .bg-white\/10    { background-color: var(--tint-10)!important; }
  .border-white\/10{ border-color: var(--tint-10)!important; }

  .bg-ink\/70 { background-color: color-mix(in oklab, var(--bg) 70%, transparent)!important; }
  .focus\:ring-neon:focus { box-shadow: 0 0 0 2px var(--ring) }
</style>


  {% block head_extra %}{% endblock %}
  {% block json_ld %}
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","name":"Full Finanzas","url":"{{ request.build_absolute_uri|default:'' }}"}
</script>
{% endblock %}
</head>

<body class="relative min-h-screen" style="background:var(--bg)">

  <!-- Fondo neon global (sutil) -->
  <div class="pointer-events-none absolute inset-0 z-0 overflow-hidden">
    <!-- velo diagonal muy sutil -->
    <div class="absolute inset-0"
      style="background:linear-gradient(135deg, rgba(210,255,0,0.06) 0%, rgba(0,0,0,0) 40%, rgba(210,255,0,0.03) 100%);">
    </div>
    <!-- radiales suaves -->
    <div class="absolute -top-24 right-[10%] h-[32rem] w-[32rem] rounded-full blur-3xl"
      style="background:radial-gradient(50% 50% at 50% 50%, rgba(210,255,0,0.14) 0%, rgba(210,255,0,0) 60%);">
    </div>
    <div class="absolute -bottom-24 left-[5%] h-[36rem] w-[36rem] rounded-full blur-3xl"
      style="background:radial-gradient(50% 50% at 50% 50%, rgba(210,255,0,0.10) 0%, rgba(210,255,0,0) 60%);">
    </div>
  </div>


  <!-- Layout principal con sidebar -->
  <div class="relative z-10 min-h-screen flex">
    {% include "includes/sidebar.html" %}

    <!-- Contenido -->
    <div class="flex-1 min-w-0">
      <header class="sticky top-0 z-30 backdrop-blur bg-ink/70 border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 h-14 flex items-center justify-between">
          <div class="flex items-center gap-3">
            <button
              class="md:hidden inline-flex items-center justify-center rounded-lg border border-white/10 px-3 py-2"
              id="openSidebar" aria-label="Abrir men√∫">
              <svg class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>
            <!-- <span class="text-sm text-white/60 hidden sm:inline">Full Finanzas</span> -->
          </div>

          <div class="flex items-center gap-3 relative">
            {# üîî Bot√≥n Notificaciones a la izquierda de Cerrar sesi√≥n #}
            <button id="btnNotificaciones"
              class="relative p-2 rounded-full border border-white/10 bg-white/5 hover:bg-white/10" aria-haspopup="true"
              aria-expanded="false">
              <span class="sr-only">Notificaciones</span> üîî
              <span id="badgeNoti"
                class="hidden absolute -top-1 -right-1 bg-red-600 text-white text-[10px] rounded-full min-w-[18px] h-[18px] px-1 flex items-center justify-center">0</span>
            </button>

            <form method="post" action="{% url 'logout' %}">
              {% csrf_token %}
              <button type="submit" class="hidden sm:inline-block text-sm text-white/70 hover:text-white">
                Cerrar sesi√≥n
              </button>
            </form>
            <div class=""><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"
                aria-hidden="true">
                <path fill="currentColor" d="M12 12c2.761 0 5-2.239 5-5s-2.239-5-5-5-5 2.239-5 5 2.239 5 5 5z" />
                <path fill="currentColor" d="M4 20c0-3.314 2.686-6 6-6h4c3.314 0 6 2.686 6 6v0H4z" />
              </svg>
            </div>

            {# Dropdown de notificaciones #}
            <div id="dropdownNoti"
              class="hidden absolute right-0 top-10 w-80 bg-[var(--card)] border border-white/10 rounded-xl shadow-2xl overflow-hidden">
              <div class="px-4 py-3 border-b border-white/10 flex items-center justify-between">
                <h4 class="font-semibold">Notificaciones</h4>
                <button id="limpiarNoti" class="text-xs text-white/60 hover:text-white">Limpiar</button>
              </div>
              <ul id="listaNotiTop" class="max-h-80 overflow-y-auto divide-y divide-white/5"></ul>
            </div>
          </div>
        </div>
      </header>

      <main id="main" class="max-w-7xl mx-auto px-4 sm:px-6 py-6 lg:py-10">
        {% block content %}{% endblock %}
      </main>


    </div>
  </div>
  {% include "includes/footer.html" %}
  {% block scripts %}
<script>
  (function(){
    const btn    = document.getElementById('btnNotificaciones');
    const dd     = document.getElementById('dropdownNoti');
    const lista  = document.getElementById('listaNotiTop');
    const badge  = document.getElementById('badgeNoti');
    const limpiar= document.getElementById('limpiarNoti');

    if (!btn || !dd || !lista || !badge) return;

    // --- helpers ---
    function li(t, time){
      return `
        <li class="px-4 py-3 text-sm hover:bg-white/5">
          <div class="flex items-start gap-2">
            <span class="mt-0.5 text-neon">‚óè</span>
            <div>
              <p>${t}</p>
              <p class="text-[11px] text-white/50 mt-0.5">${time}</p>
            </div>
          </div>
        </li>`;
    }

    async function getJSON(url){
      const r = await fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } });
      if (!r.ok) throw new Error('HTTP '+r.status);
      return r.json();
    }

    async function actualizarBadge(){
      try {
        const data = await getJSON("{% url 'contar_notificaciones' %}");
        const n = Number(data?.no_leidas || 0);
        if (n > 0){
          badge.textContent = n;
          badge.classList.remove('hidden');
        } else {
          badge.classList.add('hidden');
        }
      } catch(e){
        // silencioso
        // console.error(e);
      }
    }

    async function cargarLista(){  // tambi√©n marca le√≠das en el server (tu view lo hace)
      try {
        const data = await getJSON("{% url 'ajax_obtener_notificaciones' %}");
        const items = data?.notificaciones || [];
        if (!items.length){
          lista.innerHTML = `<li class="px-4 py-3 text-sm text-white/60">Sin notificaciones.</li>`;
        } else {
          lista.innerHTML = items.map(n => li(n.mensaje, n.fecha)).join('');
        }
        // oculto badge porque acabo de abrir y marcar
        badge.classList.add('hidden');
      } catch(e){
        lista.innerHTML = `<li class="px-4 py-3 text-sm text-rose-400">No se pudieron cargar las notificaciones.</li>`;
      }
    }

    // inicial: contador
    actualizarBadge();

    // polling badge cada 60s
    setInterval(actualizarBadge, 60000);

    // toggle dropdown
    btn.addEventListener('click', (e)=>{
      e.stopPropagation();
      const wasHidden = dd.classList.contains('hidden');
      dd.classList.toggle('hidden');
      btn.setAttribute('aria-expanded', wasHidden ? 'true' : 'false');
      if (wasHidden) cargarLista(); // si se abre, cargo y marco le√≠das
    });

    // cerrar al click fuera
    document.addEventListener('click', (e)=>{
      if (!dd.contains(e.target) && !btn.contains(e.target)){
        dd.classList.add('hidden');
        btn.setAttribute('aria-expanded','false');
      }
    });

    // bot√≥n "Limpiar" solo limpia UI (ya est√°n marcadas le√≠das por la API)
    limpiar?.addEventListener('click', (e)=>{
      e.preventDefault();
      lista.innerHTML = '';
      badge.classList.add('hidden');
    });

    // Mantengo tu API p√∫blica para push manual desde otras vistas
    window.FF_addNoti = function(text, time){
      lista.insertAdjacentHTML('afterbegin', li(text, time || new Date().toLocaleString('es-AR')));
      // subo contador local y muestro badge (opcional)
      const n = Number(badge.textContent || 0) + 1;
      badge.textContent = n;
      badge.classList.remove('hidden');
    };
  })();
</script>
  {% endblock %}
  <script>
    document.querySelectorAll('input, select, textarea').forEach(el=>{
    el.classList.add('w-full','rounded-md','border','border-white/10','bg-white','text-black','px-3','py-2','focus:outline-none','focus:ring-2');
  });
  </script>
</body>

</html>